<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>💥 욕설 변환기 + 기록 및 내 기록 공유 기능 💥</title>
<style>
  body {
    font-family: -apple-system, BlinkMacSystem, "Apple SD Gothic Neo", Pretendard, Roboto, "Noto Sans KR", "Segoe UI", "Malgun Gothic", sans-serif;
    margin: 0; height: 100vh;
    background: linear-gradient(135deg, #74b9ff, #a29bfe);
    display: flex; justify-content: center; align-items: center;
    padding: 10px; box-sizing: border-box; color: #2c3e50;
  }
  .container {
    display: flex;
    max-width: 1100px;
    width: 100%;
    background: #ffffffdd;
    backdrop-filter: blur(6px);
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    box-sizing: border-box;
  }
  .left-pane { flex: 1.5; padding: 40px 35px; box-sizing: border-box; display: flex; flex-direction: column; align-items: center; border-right: 2px solid #d2d2d2; }
  .right-pane { flex: 1; display: flex; flex-direction: column; padding: 40px 35px; box-sizing: border-box; }
  h1 { font-size: 30px; margin-bottom: 15px; text-align: center; }
  p { font-size: 16px; margin-bottom: 30px; text-align: center; }
  textarea {
    width: 100%; padding: 14px; margin-bottom: 20px; font-size: 16px;
    border: 2px solid #dfe6e9; border-radius: 10px; resize: vertical; outline: none; min-height: 100px;
    box-sizing: border-box; white-space: pre-wrap; word-break: break-word;
  }
  textarea:focus { border-color: #0984e3; }
  .controls {
    display: flex; flex-wrap: wrap; justify-content: center; align-items: center;
    margin-bottom: 25px; gap: 10px; width: 100%;
  }
  .controls label { font-size: 16px; color: #2d3436; font-weight: 500; white-space: nowrap; }
  .controls select {
    padding: 8px 12px; font-size: 16px; border-radius: 8px;
    border: 1px solid #b2bec3; background-color: #fff;
    outline: none; cursor: pointer; min-width: 120px; box-sizing: border-box;
  }
  button {
    padding: 14px 30px; font-size: 17px; font-weight: bold;
    background: linear-gradient(90deg, #0984e3, #6c5ce7);
    color: #fff; border: none; border-radius: 12px; cursor: pointer;
    transition: transform 0.15s ease, box-shadow 0.2s ease;
    min-width: 120px; box-sizing: border-box;
  }
  button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.15);
  }
  #output-wrapper {
    margin-top: 30px; text-align: left; width: 100%; box-sizing: border-box;
  }
  #output-title {
    font-size: 18px; color: #2d3436; margin-bottom: 10px; font-weight: 600;
  }
  #output {
    font-size: 28px; font-weight: bold; color: #0984e3; white-space: pre-wrap;
    background-color: #f1f2f6; padding: 20px; border-radius: 12px; min-height: 70px; box-sizing: border-box;
  }
  .history-section { flex: 1; margin-bottom: 20px; display: flex; flex-direction: column; }
  .history-title { font-weight: 700; font-size: 20px; margin-bottom: 12px; border-bottom: 2px solid #636e72; padding-bottom: 8px; }
  #history-list {
    border: 1px solid #dfe6e9;
    border-radius: 10px; padding: 10px; background: #fff;
    max-height: 140px;
    min-height: 45px;
    box-sizing: border-box;
    overflow-y: auto;
  }
  #my-record-list {
    overflow-y: auto; flex: 1; border: 1px solid #dfe6e9;
    border-radius: 10px; padding: 10px; background: #fff;
    max-height: 330px;
  }
  .history-item, .my-record-item {
    border-bottom: 1px solid #eee; padding: 8px 4px;
    display: flex; flex-direction: column; gap: 3px;
    font-size: 14px; position: relative;
  }
  .history-item:last-child, .my-record-item:last-child { border-bottom: none; }
  .history-texts { display: flex; justify-content: space-between; align-items: center; }
  .history-texts div { flex: 1; overflow-wrap: break-word; word-break: break-word; }
  .myrecord-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .myrecord-text {
    flex: 1; word-break: break-all;
    margin-right: 10px;
  }
  .myrecord-btns {
    display: flex; flex-shrink: 0;
    gap: 7px;
  }
  .btn-edit, .btn-delete {
    padding: 7px 22px; font-size: 15px; cursor: pointer; border-radius: 6px; border: none; color: white; min-width:60px;
  }
  .btn-edit { background: #0984e3;}
  .btn-delete { background: #d63031;}
  .btn-edit:hover { background: #6c5ce7;}
  .btn-delete:hover { background: #d90429;}
  #my-records-input {
    margin-top: 8px; display: flex; gap: 8px; flex-wrap: wrap;
  }
  #my-record-input-original, #my-record-input-replaced {
    flex: 1 1 45%; padding: 8px 12px; font-size: 15px; border: 1px solid #ccc; border-radius: 10px; outline: none;
  }
  #my-record-add-btn {
    padding: 8px 18px; font-size: 15px; cursor: pointer; background-color: #0984e3; color: white; border: none; border-radius: 10px;
    transition: background-color 0.3s ease; flex: 1 1 8%; min-width: 60px;
  }
  #my-record-add-btn:hover { background-color: #6c5ce7; }
  #btn-copy-my-records {
    margin-top: 12px; padding: 10px 0; cursor: pointer; background: #0984e3; color: white;
    font-weight: bold; border-radius: 10px; border: none; user-select: none; transition: background 0.3s ease;
  }
  #btn-copy-my-records:hover { background: #6c5ce7; }
  /* ----- 모바일 개선 ----- */
  @media (max-width: 480px) {
    body {
      min-width: 320px;
      padding: 0;
    }
    .container {
      flex-direction: column;
      height: auto;
      border-radius: 0;
      box-shadow: none;
      max-width: 100vw;
      width: 100vw;
      margin: 0;
    }
    .left-pane, .right-pane {
      width: 100vw !important;
      min-width: 100vw;
      padding: 15px 5vw;
      border: none;
      margin-bottom: 0;
      box-sizing: border-box;
    }
    h1 {
      font-size: 22px;
      margin-bottom: 10px;
    }
    p {
      font-size: 12px;
      margin-bottom: 15px;
    }
    textarea {
      font-size: 14px;
      padding: 10px;
      min-height: 60px;
      box-sizing: border-box;
    }
    .controls {
      flex-direction: column;
      gap: 5px;
      margin-bottom: 15px;
      align-items: stretch;
    }
    button, select {
      font-size: 15px;
      min-width: unset;
      width: 100%;
    }
    #output {
      font-size: 17px;
      padding: 14px;
      min-height: 44px;
    }
    .history-title {
      font-size: 15px;
      padding-bottom: 6px;
    }
    #history-list, #my-record-list {
      max-height: 100px;
      font-size: 13px;
      padding: 7px;
    }
    #my-records-input {
      flex-direction: column;
      gap: 4px;
    }
    #my-record-input-original, #my-record-input-replaced {
      padding: 6px 8px;
      font-size: 13px;
    }
  }
</style>
</head>
<body>
<div class="container">
  <div class="left-pane">
    <h1>💥 욕설 변환기 💥</h1>
    <p>내가, 너가, 그리고 우리가 만들어 가보자구 🎶</p>
    <textarea id="inputText" rows="4" placeholder="여기에 문장을 입력해 보세요..."></textarea>
    <div class="controls">
      <label for="wordLengthSelect">글자 수:</label>
      <select id="wordLengthSelect">
        <option value="random">무작위</option>
        <option value="1">1글자</option>
        <option value="2">2글자</option>
        <option value="3">3글자</option>
        <option value="4">4글자</option>
      </select>
      <button id="convertBtn">🚀 변환하기</button>
    </div>
    <div id="output-wrapper">
      <div id="output-title">✨ 결과:</div>
      <div id="output"></div>
      <button id="btn-add-my-record" style="display:none; margin-top:10px;">➕ 내 기록에 추가하기</button>
    </div>
  </div>
  <div class="right-pane">
    <div class="history-section">
      <div class="history-title">📝 변환 기록</div>
      <div id="history-list"></div>
    </div>
    <div class="history-section">
      <div class="history-title">📋 내 기록</div>
      <div id="my-record-list"></div>
      <div id="my-records-input">
        <input type="text" id="my-record-input-original" placeholder="원래 욕설 입력" />
        <input type="text" id="my-record-input-replaced" placeholder="변환어 입력" />
        <button id="my-record-add-btn">➕ 추가</button>
      </div>
      <button id="btn-copy-my-records" title="내 기록 URL 복사하기">📎 내 기록 URL 복사하기</button>
    </div>
  </div>
</div>
<script>
const swearWords = [
  '씨발','씨발년','시발','시발년','개새끼','병신','존나','썅','개좆같네','좆같네','좆',
  '느금마','니미','좇같네','개좇같네','좇같은','좇만이','좆만이'
];
const firstSoundMap = {
  '씨발': ['쌉','쌔','쏴','샤','싸','쌰','쏘','쑤'],
  '씨발년': ['쌍','쌀','쌰','쓩','썽','싸'],
  '썅': ['쑝','썽','쑤','씽'],
  '개새끼': ['깔','껄','꿍','꽝','꺄','꾜','껴'],
  '병신': ['빡','뻑','빵','뿜'],
  '존나': ['쫙','쭉','쭈','쪽','찟'],
  '시발': ['쌉','쌔','쏴','샤','싸','쌰','쏘','쑤'],
  '시발년': ['쌍','쌀','쌰','쓩','썽','싸'],
  '개좆같네': ['깨','끼','다','따','띠','땅','떵'],
  '좆같네': ['다','따','띠','땅','떵','띵'],
  '좆': ['따','뚜','또','땅','떵','띵'],
  '느금마': ['미','머','겨','갸','교'],
  '니미': ['마','무','님','닝','닐'],
  '좇같네': ['따','또','땍','띵','텅'],
  '개좇같네': ['꺄','껴','끼','쿄','꾜'],
  '좇같은': ['도','또','땅','띵'],
  '좇만이': ['땡','뚱','떵','띠','따'],
  '좆만이': ['또','띠','따','띵','떵']
};
const onsetConsonants = ['ㅋ','ㅍ','ㅅ','ㅈ','ㄱ','ㄷ','ㅂ','ㄴ','ㄹ'];
const vowels = ['ㅏ','ㅓ','ㅗ','ㅜ','ㅡ','ㅣ','ㅐ','ㅔ','ㅚ','ㅘ','ㅙ'];
const codaConsonants = ['', 'ㄱ', 'ㄴ', 'ㅁ', 'ㅇ', 'ㅂ', 'ㄹ'];
const forbiddenPatterns = [/가슴/, /자지/, /보지/, /섹스/, /쎅스/, /섹/, /sex/i, /섹쓰/, /꼬추/, /고추/];
function makeHangulSyllable(cho,jung,jong){
  const choList=['ㄱ','ㄲ','ㄴ','ㄷ','ㄸ','ㄹ','ㅁ','ㅂ','ㅃ','ㅅ','ㅆ','ㅇ','ㅈ','ㅉ','ㅊ','ㅋ','ㅌ','ㅍ','ㅎ'];
  const jungList=['ㅏ','ㅐ','ㅑ','ㅒ','ㅓ','ㅔ','ㅕ','ㅖ','ㅗ','ㅘ','ㅙ','ㅚ','ㅛ','ㅜ','ㅝ','ㅞ','ㅟ','ㅠ','ㅡ','ㅢ','ㅣ'];
  const jongList=['','ㄱ','ㄲ','ㄳ','ㄴ','ㄵ','ㄶ','ㄷ','ㄹ','ㄺ','ㄻ','ㄼ','ㄽ','ㄾ','ㄿ','ㅀ','ㅁ','ㅂ','ㅄ','ㅅ','ㅆ','ㅇ','ㅈ','ㅊ','ㅋ','ㅌ','ㅍ','ㅎ'];
  const choIndex=choList.indexOf(cho);
  const jungIndex=jungList.indexOf(jung);
  const jongIndex=jongList.indexOf(jong);
  if(choIndex<0||jungIndex<0||jongIndex<0) return '라';
  return String.fromCharCode(0xAC00+choIndex*21*28+jungIndex*28+jongIndex);
}
function isForbiddenWord(word){
  return forbiddenPatterns.some(p=>p.test(word));
}
function generateNewWord(lengthOption, swearWord){
  let wordLength = (lengthOption==='random') ? Math.floor(Math.random()*4)+1 : parseInt(lengthOption);
  if(isNaN(wordLength) || wordLength < 1) wordLength = 2;
  const maxAttempts = 100;
  for(let attempt=0; attempt < maxAttempts; attempt++){
    let word = '';
    for(let i=0; i<wordLength; i++){
      const cho=onsetConsonants[Math.floor(Math.random()*onsetConsonants.length)];
      const jung=vowels[Math.floor(Math.random()*vowels.length)];
      const jong=(i===wordLength-1 && Math.random()<0.5) ? codaConsonants[Math.floor(Math.random()*codaConsonants.length)] : '';
      word += makeHangulSyllable(cho,jung,jong);
    }
    if(firstSoundMap[swearWord]){
      word = firstSoundMap[swearWord][Math.floor(Math.random()*firstSoundMap[swearWord].length)] + word.slice(1);
    }
    if(word.includes('년')) continue;
    if(isForbiddenWord(word)) continue;
    return word;
  }
  return Array(wordLength).fill('가').join('');
}
const inputText = document.getElementById('inputText');
const wordLengthSelect = document.getElementById('wordLengthSelect');
const convertBtn = document.getElementById('convertBtn');
const outputDiv = document.getElementById('output');
const btnAddMyRecord = document.getElementById('btn-add-my-record');
const historyList = document.getElementById('history-list');
const myRecordList = document.getElementById('my-record-list');
const myRecordInputOriginal = document.getElementById('my-record-input-original');
const myRecordInputReplaced = document.getElementById('my-record-input-replaced');
const myRecordAddBtn = document.getElementById('my-record-add-btn');
const btnCopyMyRecords = document.getElementById('btn-copy-my-records');
let latestOriginal = '';
let latestReplacement = '';
function addHistoryItem(original, replaced){
  if(historyList.children.length >= 30){
    historyList.removeChild(historyList.lastChild);
  }
  const div = document.createElement('div');
  div.className = 'history-item';
  div.innerHTML = `<div class="history-texts"><div>${original}</div><div style="color:#0984e3">${replaced}</div></div>`;
  historyList.prepend(div);
}
function addMyRecordItem(original, replaced){
  if(!original || !replaced) return;
  const text = `${original} → ${replaced}`;
  for(let item of myRecordList.children){
    if(item.textContent === text) return;
  }
  if(myRecordList.children.length >= 30) myRecordList.removeChild(myRecordList.lastChild);
  const div = document.createElement('div');
  div.className = 'my-record-item';
  div.style.position = 'relative';
  const textDiv = document.createElement('div');
  textDiv.textContent = text;
  textDiv.style.marginRight = '100px';
  div.appendChild(textDiv);
  const btnsDiv = document.createElement('div');
  btnsDiv.style.position = 'absolute';
  btnsDiv.style.top = '5px';
  btnsDiv.style.right = '5px';
  btnsDiv.style.display = 'flex';
  btnsDiv.style.gap = '5px';
  const btnEdit = document.createElement('button');
  btnEdit.className = 'btn-edit';
  btnEdit.textContent = '수정';
  btnEdit.style.minWidth = '60px';
  btnEdit.addEventListener('click', () => {
    const newOriginal = prompt('원본 텍스트 수정', original);
    if(newOriginal === null) return;
    const newReplaced = prompt('변환 텍스트 수정', replaced);
    if(newReplaced === null) return;
    if(newOriginal.trim() && newReplaced.trim()){
      textDiv.textContent = `${newOriginal.trim()} → ${newReplaced.trim()}`;
      div.dataset.original = newOriginal.trim();
      div.dataset.replaced = newReplaced.trim();
    }
  });
  btnsDiv.appendChild(btnEdit);
  const btnDelete = document.createElement('button');
  btnDelete.className = 'btn-delete';
  btnDelete.textContent = '삭제';
  btnDelete.style.minWidth = '60px';
  btnDelete.addEventListener('click', () => {
    myRecordList.removeChild(div);
  });
  btnsDiv.appendChild(btnDelete);
  div.appendChild(btnsDiv);
  myRecordList.prepend(div);
}
convertBtn.addEventListener('click', () => {
  const text = inputText.value.trim();
  if(!text){
    outputDiv.textContent = '문장을 입력해주세요!';
    btnAddMyRecord.style.display = 'none';
    return;
  }
  const sortedSwears = [...swearWords].sort((a,b) => b.length - a.length);
  let replaced = text;
  sortedSwears.forEach(word => {
    const regex = new RegExp(word, 'gi');
    replaced = replaced.replace(regex, () => generateNewWord(wordLengthSelect.value, word));
  });
  outputDiv.textContent = replaced;
  latestOriginal = text;
  latestReplacement = replaced;
  btnAddMyRecord.style.display = 'inline-block';
  addHistoryItem(text, replaced);
});
btnAddMyRecord.addEventListener('click', () => {
  if(latestOriginal && latestReplacement){
    addMyRecordItem(latestOriginal, latestReplacement);
    btnAddMyRecord.style.display = 'none';
  }
});
myRecordAddBtn.addEventListener('click', () => {
  const ori = myRecordInputOriginal.value.trim();
  const rep = myRecordInputReplaced.value.trim();
  if(!ori || !rep){
    alert('원래 욕설과 변환어를 모두 입력해주세요.');
    return;
  }
  addMyRecordItem(ori, rep);
  myRecordInputOriginal.value = '';
  myRecordInputReplaced.value = '';
});

// ---- 핵심 추가: URL 짧게 (Base64) ----
function encodeRecordsShort(records) {
  // 문자열 → base64 → (특수문자 안전치환)
  return btoa(unescape(encodeURIComponent(records.join('\n'))))
    .replace(/\+/g, '-').replace(/\//g,'_').replace(/=+$/,'');
}
function decodeRecordsShort(str) {
  try {
    return decodeURIComponent(escape(atob(str.replace(/-/g,'+').replace(/_/g,'/')))).split('\n');
  } catch(e) { return []; }
}
btnCopyMyRecords.addEventListener('click', () => {
  if(myRecordList.children.length === 0){
    alert('내 기록이 없습니다.');
    return;
  }
  const records = [];
  for(let item of myRecordList.children){
    records.push(item.textContent);
  }
  // Base64 인코드로 축약
  const recordId = encodeRecordsShort(records);
  const url = location.origin + location.pathname + '?myRecords=' + recordId;
  navigator.clipboard.writeText(url)
    .then(() => alert('내 기록 URL이 복사되었습니다! 붙여넣기 하세요.'))
    .catch(() => alert('복사 실패'));
});
window.addEventListener('load', () => {
  const params = new URLSearchParams(location.search);
  const myRecordsStr = params.get('myRecords');
  if(myRecordsStr){
    try {
      const stored = decodeRecordsShort(myRecordsStr);
      stored.slice(-30).forEach(text => {
        const [ori, rep] = text.split('→').map(s => s.trim());
        if(ori && rep) addMyRecordItem(ori, rep);
      });
    } catch(e) { console.error("내 기록 로드 실패", e); }
  }
});
</script>
</body>
</html>
